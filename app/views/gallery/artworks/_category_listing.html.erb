<!-- category navigation bar -->
<div class="mb-8 hidden sm:flex sm:justify-center">
  <nav>
    <ul class="flex flex-wrap items-center justify-center gap-x-6 gap-y-3 text-sm">
      <li><%= link_to "Gallery â€º", gallery_root_path, class: "text-gray-400 hover:text-blue-800 px-2 py-1" %></li>
      
      <!-- Paintings -->
      <% paintings = @gallery_categories&.find { |cat| cat.title == "Paintings" } %>
      <% if paintings.present? || defined?(gallery_paintings_path) %>
        <li>
          <%= link_to paintings&.path || gallery_paintings_path, 
              class: "p-1 #{(paintings && request.path == paintings.path) || request.path == gallery_paintings_path ? 'border-b-2 border-black hover:border-blue-800 hover:text-blue-800' : 'hover:text-blue-800'}" do %>
            Paintings
            <% if paintings.present? %>
              <span>(<%= paintings.artwork_count %>)</span>
            <% end %>
          <% end %>
        </li>
      <% end %>
      
      <!-- Prints -->
      <% prints = @gallery_categories&.find { |cat| cat.title == "Prints" } %>
      <% if prints.present? || defined?(gallery_prints_path) %>
        <li>
          <%= link_to prints&.path || gallery_prints_path, 
              class: "p-1 #{(prints && request.path == prints.path) || request.path == gallery_prints_path ? 'border-b-2 border-black hover:text-blue-800' : 'hover:text-blue-800'}" do %>
            Prints
            <% if prints.present? %>
              <span>(<%= prints.artwork_count %>)</span>
            <% end %>
          <% end %>
        </li>
      <% end %>
      
      <!-- Indian Leaves -->
      <% indian_leaves = @gallery_categories&.find { |cat| cat.title == "Indian Leaves" } %>
      <% if indian_leaves.present? || defined?(gallery_indian_leaves_path) %>
        <li>
          <%= link_to indian_leaves&.path || gallery_indian_leaves_path, 
              class: "p-1 #{(indian_leaves && request.path == indian_leaves.path) || request.path == gallery_indian_leaves_path ? 'border-b-2 border-black hover:text-blue-800' : 'hover:text-blue-800'}" do %>
            Indian Leaves
            <% if indian_leaves.present? %>
              <span>(<%= indian_leaves.artwork_count %>)</span>
            <% end %>
          <% end %>
        </li>
      <% end %>
      
      <!-- Indian Waves -->
      <% indian_waves = @gallery_categories&.find { |cat| cat.title == "Indian Waves" } %>
      <% if indian_waves.present? || defined?(gallery_indian_waves_path) %>
        <li>
          <%= link_to indian_waves&.path || gallery_indian_waves_path, 
              class: "p-1 #{(indian_waves && request.path == indian_waves.path) || request.path == gallery_indian_waves_path ? 'border-b-2 border-black hover:text-blue-800' : 'hover:text-blue-800'}" do %>
            Indian Waves
            <% if indian_waves.present? %>
              <span>(<%= indian_waves.artwork_count %>)</span>
            <% end %>
          <% end %>
        </li>
      <% end %>
      
      <!-- Design -->
      <% design = @gallery_categories&.find { |cat| cat.title == "Design" } %>
      <% if design.present? || defined?(gallery_design_path) %>
        <li>
          <%= link_to design&.path || gallery_design_path, 
              class: "p-1 #{(design && request.path == design.path) || request.path == gallery_design_path ? 'border-b-2 border-black hover:text-blue-800' : 'hover:text-blue-800'}" do %>
            Design
            <% if design.present? %>
              <span>(<%= design.artwork_count %>)</span>
            <% end %>
          <% end %>
        </li>
      <% end %>
      
      <!-- Other -->
      <% other = @gallery_categories&.find { |cat| cat.title == "Other" } %>
      <% if other.present? || defined?(gallery_other_path) %>
        <li>
          <%= link_to other&.path || gallery_other_path, 
              class: "p-1 #{(other && request.path == other.path) || request.path == gallery_other_path ? 'border-b-2 border-black hover:text-blue-800' : 'hover:text-blue-800'}" do %>
            Other
            <% if other.present? %>
              <span>(<%= other.artwork_count %>)</span>
            <% end %>
          <% end %>
        </li>
      <% end %>
      
      <!-- Missing Works -->
      <% missing_works = @special_collections&.find { |cat| cat.title == "Missing Works" } %>
      <% if missing_works.present? || defined?(gallery_missing_works_path) %>
        <li>
          <%= link_to missing_works&.path || gallery_missing_works_path, 
              class: "p-1 #{(missing_works && request.path == missing_works.path) || request.path == gallery_missing_works_path ? 'border-b-2 border-black hover:text-blue-800' : 'hover:text-blue-800'}" do %>
            Missing Works
            <% if missing_works.present? %>
              <span>(<%= missing_works.artwork_count %>)</span>
            <% end %>
          <% end %>
        </li>
      <% end %>
      
      <!-- Destroyed -->
      <% destroyed = @special_collections&.find { |cat| cat.title == "Destroyed" } %>
      <% if destroyed.present? || defined?(gallery_destroyed_path) %>
        <li>
          <%= link_to destroyed&.path || gallery_destroyed_path, 
              class: "p-1 #{(destroyed && request.path == destroyed.path) || request.path == gallery_destroyed_path ? 'border-b-2 border-black hover:text-blue-800' : 'hover:text-blue-800'}" do %>
            Destroyed
            <% if destroyed.present? %>
              <span>(<%= destroyed.artwork_count %>)</span>
            <% end %>
          <% end %>
        </li>
      <% end %>
      
      <!-- Memories of Bombay / Mumbai -->
      <% memories = @gallery_categories&.find { |cat| cat.title == "Memories of Bombay / Mumbai" } %>
      <% if memories.present? || defined?(gallery_memories_of_bombay_mumbai_path) %>
        <li>
          <%= link_to memories&.path || gallery_memories_of_bombay_mumbai_path, 
              class: "p-1 #{(memories && request.path == memories.path) || request.path == gallery_memories_of_bombay_mumbai_path ? 'border-b-2 border-black hover:text-blue-800' : 'hover:text-blue-800'}" do %>
            Memories of Bombay / Mumbai
            <% if memories.present? %>
              <span>(<%= memories.artwork_count %>)</span>
            <% end %>
          <% end %>
        </li>
      <% end %>
      
      <!-- Quantel Paintbox -->
      <% quantel = @gallery_categories&.find { |cat| cat.title == "Quantel Paintbox" } %>
      <% if quantel.present? || defined?(gallery_quantel_paintbox_path) %>
        <li>
          <%= link_to quantel&.path || gallery_quantel_paintbox_path, 
              class: "p-1 #{(quantel && request.path == quantel.path) || request.path == gallery_quantel_paintbox_path ? 'border-b-2 border-black hover:text-blue-800' : 'hover:text-blue-800'}" do %>
            Quantel Paintbox
            <% if quantel.present? %>
              <span>(<%= quantel.artwork_count %>)</span>
            <% end %>
          <% end %>
        </li>
      <% end %>
    </ul>
  </nav>
</div>

<div class="lg:flex lg:gap-8">
  
  <!-- sidebar filters -->
  <aside class="lg:w-80 mb-8 p-6 bg-[#e6e6e6]">
    <div class="sticky top-24">
      <% if @category_page.present? %>
        <h1 class="text-2xl font-semibold mb-4"><%= @category_page.title %></h1>
        <% if @category_page.description.present? %>
          <p class="text-md text-pretty mb-6"><%= @category_page.description %></p>
        <% end %>
      <% else %>
        <h1 class="text-2xl font-semibold mb-6"><%= @category_title %></h1>
      <% end %>
      
      <%= form_with url: request.path, method: :get, class: "space-y-6" do |f| %>
        
        <!-- design subcategories (only for design pages) -->
        <% if @design_subcategories.present? %>
          <div>
            <h3 class="font-semibold mb-3">Categories</h3>
            <div class="space-y-2">
              <%= link_to "All Designs", 
                  gallery_design_path, 
                  class: "block text-sm #{@active_subcategory.blank? ? 'font-semibold text-black' : 'text-gray-600 hover:text-black'}" %>
              
              <% @design_subcategories.each do |subcategory| %>
                <%= link_to subcategory.titleize, 
                    gallery_design_subcategory_path(subcategory: subcategory), 
                    class: "block text-sm #{@active_subcategory == subcategory ? 'font-semibold text-black' : 'text-gray-600 hover:text-black'}" %>
              <% end %>
            </div>
          </div>
        <% end %>

        <% if params[:s].present? || params[:dates].present? %>
          <%= link_to "Clear filters", request.path, class: "block text-sm text-gray-600 hover:text-blue-800" %>
        <% else %>
          <span class="text-gray-600">Filters</span>
        <% end %>

        <!-- keyword search -->
        <div>
          <%= f.text_field :s, 
              value: params[:s], 
              placeholder: "Keyword",
              class: "w-full px-3 py-2 border border-black bg-[#e6e6e6]" %>
        </div>

        <!-- date filter -->
        <% if @show_date_filter %>
          <div>
            <%= f.select :dates, 
                options_for_select([["All dates", ""]] + decade_ranges, params[:dates]),
                {},
                class: "w-full px-3 py-2 border border-black bg-[#e6e6e6]",
                onchange: "this.form.submit()" %>
          </div>
        <% elsif @fixed_year.present? %>
          <div>
            <label class="block text-sm font-semibold mb-2">Date</label>
            <p class="text-gray-600"><%= @fixed_year %></p>
          </div>
        <% end %>

        <%#= f.submit "Search", class: "w-full bg-black text-white py-2 px-4 hover:bg-gray-800 transition-colors cursor-pointer" %>
      <% end %>
    </div>
  </aside>

  <!-- artworks grid -->
  <div class="flex-1">
    <!-- search/filter summary -->
    <% if params[:s].present? || params[:dates].present? %>
      <div class="mb-4">
        <% if params[:s].present? %>
          <h2 class="text-xl font-semibold">
            "<%= params[:s] %>"
            <span class="text-gray-600 font-normal">
              (<%= @artworks.total_count %>)
            </span>
          </h2>
        <% elsif params[:dates].present? %>
          <h2 class="text-xl font-semibold">
            <%= params[:dates] %>
            <span class="text-gray-600 font-normal">
              (<%= @artworks.total_count %>)
            </span>
          </h2>
        <% end %>
      </div>
    <% end %>

    <% if @artworks.present? && @artworks.count > 0 %>
      <div class="items-end grid grid-cols-1 sm:grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6 mb-8">
        <% @artworks.each do |artwork| %>
          <%= render partial: 'shared/artwork_card', locals: { artwork: artwork } %>
        <% end %>
      </div>

      <!-- pagination -->
      <% if @artworks.total_pages > 1 %>
        <div class="flex justify-center">
          <%= paginate @artworks, theme: 'twitter-bootstrap-4' %>
        </div>
      <% end %>
    <% else %>
      <div class="text-center py-16">
        <i class="fa-solid fa-image text-6xl text-gray-300 mb-4"></i>
        <p class="text-xl text-gray-600">No artworks found</p>
        <% if params[:s].present? || params[:dates].present? %>
          <%= link_to "Clear filters", request.path, class: "inline-block mt-4 text-black hover:underline" %>
        <% end %>
      </div>
    <% end %>
  </div>
</div>