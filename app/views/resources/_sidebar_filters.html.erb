<%
  # set defaults
  category_page ||= @category_page
  category_title ||= @category_title
  text_subcategories ||= @text_subcategories
  publication_subcategories ||= @publication_subcategories
  exhibition_types ||= @exhibition_types
  active_subcategory ||= @active_subcategory
  active_type ||= @active_type
  show_date_filter ||= @show_date_filter
  show_subcategory_filter ||= @show_subcategory_filter
  show_type_filter ||= @show_type_filter
  show_grid_view ||= @show_grid_view
  regions ||= @regions
  show_region_filter ||= @show_region_filter
  active_region ||= @active_region
%>

<% unless show_grid_view %>
  <aside class="lg:w-80 mb-8 p-6 bg-[#e6e6e6]">
    <div class="sticky top-24">
      <% if category_page.present? %>
        <h1 class="text-2xl font-semibold mb-4"><%= category_page.title %></h1>
        <% if category_page.description.present? %>
          <p class="text-md text-pretty mb-6"><%= category_page.description %></p>
        <% end %>
      <% else %>
        <h1 class="text-2xl font-semibold mb-6"><%= category_title %></h1>
      <% end %>
      
      <%= form_with url: request.path, method: :get, class: "space-y-6" do |f| %>

        <!-- text subcategories filter -->
        <% if show_subcategory_filter && text_subcategories.present? %>
          <div>
            <h2 class="text-sm font-semibold text-gray-600 mb-2">Types</h2>
            <%= select_tag :subcategory,
                options_for_select(
                  [["All Texts", resources_texts_path]] + 
                  text_subcategories.map { |slug, name| [name, resources_texts_subcategory_path(subcategory: slug)] },
                  active_subcategory.present? ? resources_texts_subcategory_path(subcategory: active_subcategory) : resources_texts_path
                ),
                class: "w-full px-3 py-2 border border-black bg-[#e6e6e6]",
                onchange: "window.location.href = this.value;" %>
          </div>
        <% end %>

        <!-- publication subcategories filter -->
        <% if show_subcategory_filter && publication_subcategories.present? %>
          <div>
            <h2 class="text-sm font-semibold text-gray-600 mb-2">Types</h2>
            <%= select_tag :subcategory,
                options_for_select(
                  [["All Publications", resources_publications_path]] + 
                  publication_subcategories.map { |slug, name| [name, resources_publications_subcategory_path(subcategory: slug)] },
                  active_subcategory.present? ? resources_publications_subcategory_path(subcategory: active_subcategory) : resources_publications_path
                ),
                class: "w-full px-3 py-2 border border-black bg-[#e6e6e6]",
                onchange: "window.location.href = this.value;" %>
          </div>
        <% end %>

        <!-- exhibition type filter -->
        <% if show_type_filter && exhibition_types.present? %>
          <div>
            <h2 class="text-sm font-semibold text-gray-600 mb-2">Types</h2>
            <%= f.select :type,
                options_for_select([["All Types", ""]] + exhibition_types, active_type),
                {},
                class: "w-full px-3 py-2 border border-black bg-[#e6e6e6]",
                onchange: "this.form.submit()" %>
          </div>
        <% end %>

        <!-- region filter (for collections) -->
        <% if show_region_filter && regions.present? %>
          <div>
            <h2 class="text-sm font-semibold text-gray-600 mb-2">Region</h2>
            <%= f.select :region,
                options_for_select([["All Regions", ""]] + regions.map { |r| [r, r.downcase] }, active_region),
                {},
                class: "w-full px-3 py-2 border border-black bg-[#e6e6e6]",
                onchange: "this.form.submit()" %>
          </div>
        <% end %>

        <!-- keyword search -->
        <div>
          <h2 class="text-sm font-semibold text-gray-600 mb-2">Search</h2>
          <%= f.text_field :s, 
              value: params[:s], 
              placeholder: "Keyword",
              class: "w-full px-3 py-2 border border-black bg-[#e6e6e6]" %>
        </div>

        <!-- date filter -->
        <% if show_date_filter %>
          <div>
            <h2 class="text-sm font-semibold text-gray-600 mb-2">Dates</h2>
            <%= f.select :dates, 
                options_for_select([["All dates", ""]] + decade_ranges, params[:dates]),
                {},
                class: "w-full px-3 py-2 border border-black bg-[#e6e6e6]",
                onchange: "this.form.submit()" %>
          </div>
        <% end %>

        <!-- clear filters -->
        <% if params[:s].present? || params[:dates].present? || params[:region].present? || params[:type].present? || params[:subcategory].present? %>
          <%= link_to "Clear filters", request.path, class: "block text-sm text-gray-600 hover:text-blue-800" %>
        <% end %>

      <% end %>
    </div>
  </aside>
<% end %>