<!-- category/collection page with filters -->

<!-- hero banner (if category page exists) -->
<% if @category_page.present? && @category_page.cloudinary_public_id.present? %>
  <div class="mb-8 -mx-4 lg:-mx-0">
    <div class="relative h-64 lg:h-80 overflow-hidden">
      <%= image_tag @category_page.hero_url, 
          alt: @category_page.title,
          class: "w-full h-full object-cover" %>
      <div class="absolute inset-0 bg-gradient-to-t from-black/50 to-transparent"></div>
      <div class="absolute bottom-0 left-0 right-0 p-8 text-white">
        <h1 class="text-4xl lg:text-5xl font-bold mb-2"><%= @category_page.title %></h1>
        <% if @category_page.description.present? %>
          <p class="text-lg max-w-3xl"><%= truncate(@category_page.description, length: 200) %></p>
        <% end %>
      </div>
    </div>
  </div>
<% end %>

<!-- intro text (if category page exists but no hero image) -->
<% if @category_page.present? && @category_page.description.present? && @category_page.cloudinary_public_id.blank? %>
  <div class="mb-8 p-6 bg-gray-50 rounded-lg">
    <h1 class="text-3xl lg:text-4xl font-bold mb-4"><%= @category_page.title %></h1>
    <div class="prose prose-lg max-w-none">
      <%= simple_format(@category_page.description) %>
    </div>
  </div>
<% end %>

<div class="lg:flex lg:gap-8">
  
  <!-- sidebar filters -->
  <aside class="lg:w-64 mb-8 lg:mb-0">
    <div class="sticky top-24">
      <h2 class="text-xl font-semibold mb-4">Filter</h2>
      
      <%= form_with url: request.path, method: :get, class: "space-y-6" do |f| %>
        
        <!-- design subcategories (only for design pages) -->
        <% if @design_subcategories.present? %>
          <div>
            <h3 class="font-semibold mb-3">Categories</h3>
            <div class="space-y-2">
              <%= link_to "All Designs", 
                  gallery_design_path, 
                  class: "block text-sm #{@active_subcategory.blank? ? 'font-semibold text-black' : 'text-gray-600 hover:text-black'}" %>
              
              <% @design_subcategories.each do |subcategory| %>
                <%= link_to subcategory.titleize, 
                    gallery_design_subcategory_path(subcategory: subcategory), 
                    class: "block text-sm #{@active_subcategory == subcategory ? 'font-semibold text-black' : 'text-gray-600 hover:text-black'}" %>
              <% end %>
            </div>
          </div>
        <% end %>

        <!-- keyword search -->
        <div>
          <label class="block text-sm font-semibold mb-2">Search</label>
          <%= f.text_field :s, 
              value: params[:s], 
              placeholder: "Search artworks...",
              class: "w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-black focus:border-transparent" %>
        </div>

        <!-- date filter -->
        <% if @show_date_filter %>
          <div>
            <label class="block text-sm font-semibold mb-2">Date</label>
            <%= f.select :dates, 
                options_for_select([["All dates", ""]] + decade_ranges, params[:dates]),
                {},
                class: "w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-black focus:border-transparent",
                onchange: "this.form.submit()" %>
          </div>
        <% elsif @fixed_year.present? %>
          <div>
            <label class="block text-sm font-semibold mb-2">Date</label>
            <p class="text-gray-600"><%= @fixed_year %></p>
          </div>
        <% end %>

        <%= f.submit "Search", class: "w-full bg-black text-white py-2 px-4 rounded-md hover:bg-gray-800 transition-colors cursor-pointer" %>
        
        <% if params[:s].present? || params[:dates].present? %>
          <%= link_to "Clear filters", request.path, class: "block text-center text-sm text-gray-600 hover:text-black" %>
        <% end %>
      <% end %>
    </div>
  </aside>

  <!-- artworks grid -->
  <main class="flex-1">
    <div class="mb-6 flex items-center justify-between">
      <h1 class="text-3xl lg:text-4xl font-bold"><%= @category_title %></h1>
      <p class="text-gray-600"><%= @artworks.total_count %> works</p>
    </div>

    <% if @artworks.present? && @artworks.count > 0 %>
      <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6 mb-8">
        <% @artworks.each do |artwork| %>
          <%= render partial: 'shared/artwork_card', locals: { artwork: artwork } %>
        <% end %>
      </div>

      <!-- pagination -->
      <% if @artworks.total_pages > 1 %>
        <div class="flex justify-center">
          <%= paginate @artworks, theme: 'twitter-bootstrap-4' %>
        </div>
      <% end %>
    <% else %>
      <div class="text-center py-16">
        <i class="fa-solid fa-image text-6xl text-gray-300 mb-4"></i>
        <p class="text-xl text-gray-600">No artworks found</p>
        <% if params[:s].present? || params[:dates].present? %>
          <%= link_to "Clear filters", request.path, class: "inline-block mt-4 text-black hover:underline" %>
        <% end %>
      </div>
    <% end %>
  </main>
</div>